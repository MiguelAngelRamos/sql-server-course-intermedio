```sql
-- =========================================================
-- Procedimiento: actualiza estado de una orden con validaciones
-- =========================================================
CREATE PROCEDURE sales.usp_SetOrderStatus             -- Crea el procedimiento en esquema sales
    @OrderId   INT,                                   -- Parámetro: identificador de orden
    @NewStatus CHAR(1)                                -- SET
AS
BEGIN                                                 -- Inicio del procedimiento
    SET NOCOUNT ON;                                   -- Evita mensajes de "N filas afectadas" para limpiar salida
    BEGIN TRY                                         -- Comienza bloque TRY para manejo de errores
        IF @NewStatus NOT IN ('N','P','C')            -- Valida que el estado sea permitido
        BEGIN
            RAISERROR('Estado inválido. Use N, P o C.', 16, 1); -- Lanza error de nivel 16 (usuario)
            RETURN;                                   -- Termina la ejecución
        END

        IF NOT EXISTS (SELECT 1 FROM sales.Orders WHERE OrderId = @OrderId) -- Verifica que exista la orden
        BEGIN
            RAISERROR('La orden no existe.', 16, 1);  -- Lanza error si no existe
            RETURN;                                   -- Termina la ejecución
        END

        BEGIN TRAN;                                   -- Inicia transacción explícita
            UPDATE sales.Orders                        -- Actualiza la tabla de órdenes
            SET Status = @NewStatus                    -- Asigna el nuevo estado
            WHERE OrderId = @OrderId;                  -- Filtra por la orden objetivo
        COMMIT TRAN;                                  -- Confirma la transacción
    END TRY                                            -- Fin del TRY
    BEGIN CATCH                                        -- Comienza el manejo de errores
        IF XACT_STATE() <> 0 ROLLBACK TRAN;           -- Revierte si hay transacción activa
        DECLARE @ErrMsg NVARCHAR(4000) = ERROR_MESSAGE(); -- Captura el mensaje de error
        RAISERROR(@ErrMsg, 16, 1);                    -- Propaga el error con severidad 16
    END CATCH;                                         -- Fin del CATCH
END;                                                   -- Fin del procedimiento
GO                                                    -- Fin del lote

-- Ejemplo:
-- EXEC sales.usp_SetOrderStatus @OrderId = 3, @NewStatus = 'P';
```