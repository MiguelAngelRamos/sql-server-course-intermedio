## JOIN, AGRUPACIONES, FUNCIONES DE AGREGACIÓN Y ORDER BY
```sql
-- ventas por cliente

SELECT c.CustomerId, c.FirstName, c.LastName,
       COUNT(DISTINCT o.OrderId) AS Ordenes,
       SUM(oi.Quantity * oi.UnitPrice) AS MontoTotal
FROM sales.Customers c
JOIN sales.Orders o ON o.CustomerId = c.CustomerId
JOIN sales.OrderItems oi ON oi.OrderId = o.OrderId
GROUP BY c.CustomerId, c.FirstName, c.LastName
ORDER BY MontoTotal DESC;

```

## Funciones Escalar 

-- Funciones Escalares se caracterizan por devolver un solo valor, no está pensada para realizar cambios en la base de datos

```sql

CREATE FUNCTION sales.fn_OrderTotal 
(
  @OrderId INT 
)
RETURNS DECIMAL(18,2)
AS
BEGIN
  DECLARE @Total DECIMAL(18,2)
  SELECT @Total = SUM(Quantity * UnitPrice)
  FROM sales.OrderItems
  WHERE OrderId = @OrderId
  RETURN ISNULL(@Total, 0.00)
END
GO

```

## Consulta

```sql
SELECT o.OrderId, sales.fn_OrderTotal(o.OrderId) AS TotalOrden
FROM sales.Orders AS o;
```