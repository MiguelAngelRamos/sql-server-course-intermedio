## 1. Creación de la base de datos y sus esquemas

```sql
CREATE DATABASE ClinicaVeterinariaDB;
GO

USE ClinicaVeterinariaDB;
GO

-- 1. Crear los esquemas
CREATE SCHEMA Adm; -- Para tablas administrativas (Propietarios)
GO
CREATE SCHEMA Med; -- Para tablas médicas (Mascotas)
GO
```

## 2. Creación de Tablas dentro de los Esquemas

```sql
-- Tabla de Propietarios (dentro del esquema Adm)
CREATE TABLE Adm.Propietarios (
    PropietarioID INT PRIMARY KEY IDENTITY(1,1),
    NombreCompleto NVARCHAR(150) NOT NULL,
    Telefono VARCHAR(20) NOT NULL,
    Email NVARCHAR(100) UNIQUE NULL
);
GO

-- Tabla de Mascotas (dentro del esquema Med)
CREATE TABLE Med.Mascotas (
    MascotaID INT PRIMARY KEY IDENTITY(1,1),
    NombreMascota NVARCHAR(100) NOT NULL,
    Especie NVARCHAR(50) NOT NULL,
    Raza NVARCHAR(50) NULL,
    FechaNacimiento DATE NULL,
    
    -- La llave foránea ahora apunta a la tabla en el otro esquema
    PropietarioID INT NOT NULL,
    
    FOREIGN KEY (PropietarioID) REFERENCES Adm.Propietarios(PropietarioID)
);
GO
```

## 3. Principios de Seguridad (Logins, Usuarios y Roles)

Crearemos dos perfiles: un **Recepcionista** (que maneja dueños y citas) y un **Veterinario** (que maneja las mascotas)


```sql
-- 1. Crear Logins (a nivel de servidor)
-- (Se crean en la base de datos 'master' a nivel de servidor, no en 'ClinaVeterinariaDB')
-- Asegurate de ejecutar esto fuera de la transacción de la DB especifica si fuera necesario

USE Master;
GO

-- 2. Crear Usuarios (a nivel de Base de Datos)
CREATE USER [UsuarioRecepcion] FOR LOGIN [LoginRecepcion];
CREATE USER [UsuarioVeterinario] FOR LOGIN [LoginVeterinario];
GO

-- 3. Crear Roles (Grupos de permisos)
CREATE ROLE [Rol_Recepcionista];
CREATE ROLE [Rol_Veterinario];
GO

-- 4. Asignar Usuarios a Roles
ALTER ROLE [Rol_Recepcionista] ADD MEMBER [UsuarioRecepcion];
ALTER ROLE [Rol_Veterinario] ADD MEMBER [UsuarioVeterinario];
GO
```

## 4. Control de Acceso (Permisos - GRANT)

Ahora asignamos los permisos a los roles sobre las tablas en sus esquemas

```sql
USE ClinicaVeterinariaDB;
GO

-- Permisos para el Rol_Recepcionista:
-- Puede gestionar propietarios (CRUD completo)
GRANT SELECT, INSERT, UPDATE, DELETE ON Adm.Propietarios TO [Rol_Recepcionista];
-- Solo va poder ver la información de las mascotas (para consultar historial)
GRANT SELECT ON Med.Mascotas TO [Rol_Recepcionista];


-- Permisos para el ROL_Veterinario
-- Puede gestionar mascotas (CRUD COMPLETO)
GRANT SELECT, INSERT, UPDATE, DELETE ON Med.Mascotas TO [Rol_Veterinario];
-- Solo va poder ver la información de los propietarios (para contactarlos)
GRANT SELECT ON Adm.Propietarios TO  [Rol_Veterinario];
```