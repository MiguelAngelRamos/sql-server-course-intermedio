## Store Procedure

```sql
USE ClinicaVeterinariaDB;
GO

CREATE PROCEDURE Med.sp_RegistrarMascota
    -- 1. Parámetros de Entrada: Son los datos que el SP necesita para trabajar
    @NombreMascota NVARCHAR(100),
    @Especie NVARCHAR(50),
    @Raza NVARCHAR(50),
    @FechaNacimiento DATE,
    @PropietarioID INT
AS
BEGIN
    -- (Buena práctica: Evita que SQL devuelva mensajes de "X filas afectadas")
    SET NOCOUNT ON;

    -- 2. Validación: Verificamos que el PropietarioID exista en la tabla de dueños
    IF NOT EXISTS (SELECT 1 FROM Adm.Propietarios WHERE PropietarioID = @PropietarioID)
    BEGIN
        -- 3. Error Controlado: Si no existe, lanzamos un error claro y salimos.
        RAISERROR('Error de Validación: El PropietarioID %d no existe.', 16, 1, @PropietarioID);
        RETURN;
    END

    -- 4. Bloque TRY: Intentamos ejecutar la lógica principal
    BEGIN TRY
        
        -- 5. Lógica de Negocio: La inserción
        INSERT INTO Med.Mascotas 
            (NombreMascota, Especie, Raza, FechaNacimiento, PropietarioID)
        VALUES 
            (@NombreMascota, @Especie, @Raza, @FechaNacimiento, @PropietarioID);

        PRINT 'Mascota registrada exitosamente.';

    END TRY
    -- 6. Bloque CATCH: Si algo falla en el TRY (ej. un dato nulo en columna NOT NULL)
    BEGIN CATCH
        -- 7. Manejo del Error: Informamos del error (en un sistema real, lo guardaríamos en un log)
        PRINT 'Ha ocurrido un error inesperado al registrar la mascota.';
        
        -- Re-lanzamos el error original para que la aplicación que llamó al SP se entere
        THROW; 
    END CATCH
END
GO
```

## Invocacion

```sql
EXEC Med.sp_RegistrarMascota 
    @NombreMascota = 'Rocket', 
    @Especie = 'Conejo', 
    @Raza = 'Cabeza de León', 
    @FechaNacimiento = '2024-01-10', 
    @PropietarioID = 1; -- Asumiendo que el ID 1 (Carla) existe
```